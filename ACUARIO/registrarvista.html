<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0, maximum-scale=3.0, minimum-scale=1.0">
 <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" >
	<link rel="stylesheet" href="estilos.css">
	<title>REGISTRO</title> 

</head>  
<body>
 <form class="formulario" method="POST">
    
    <h1>Registrate</h1>  
     <div class="contenedor">
     
     <div class="input-contenedor">
         <i class="fas fa-user icon"></i>
         <input id="Name" type="text" placeholder="Nombre Completo" name="nombre" required>
         
         </div>
         
         <div class="input-contenedor">
         <i class="fas fa-envelope icon"></i>
         <input id="email" type="text" placeholder="Correo Electrónico" name="correo"required>
         
         </div>
         
         <div class="input-contenedor">
        <i class="fas fa-key icon"></i>
         <input id="password" type="password" placeholder="Contraseña" name="contraseña"required>
         
         </div>
         <input id="signUp" value="Registrate" class="button" name="btn_registro">
         <p>Al registrarte, aceptas nuestras Condiciones de uso y Política de privacidad.</p>
         <p>¿Ya tienes una cuenta?<a class="link" href="loginvista.html"> Iniciar Sesión</a></p>
     </div>
    </form>
    Franco Joseph Ortega Gutierrez 18301008 8vo B CETI Rio Santiago

</body>
<script type="module">
	// Import the functions you need from the SDKs you need
	import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
	import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js";
	import { getAuth, signOut, sendPasswordResetEmail, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, deleteUser  } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";
	
	// TODO: Add SDKs for Firebase products that you want to use
	// https://firebase.google.com/docs/web/setup#available-libraries
  
	// Your web app's Firebase configuration
	const firebaseConfig = {
	  apiKey: "AIzaSyAXapsdZ_QQ4sLtF48Yv5ovGz87eUwb1RM",
	  authDomain: "tayforlive.firebaseapp.com",
	  databaseURL: "https://tayforlive-default-rtdb.firebaseio.com",
	  projectId: "tayforlive",
	  storageBucket: "tayforlive.appspot.com",
	  messagingSenderId: "163156985446",
	  appId: "1:163156985446:web:3ada60c6727b7c5ca68fa7"
	};
  
	// Initialize Firebase
	const app = initializeApp(firebaseConfig);
	const database = getDatabase(app);
	const auth = getAuth();
	//-------------------Variables---------------------
var uid;


//---------------------------Registro------------------
signUp.addEventListener('click',(e) =>{
	var username = document.getElementById('Name').value;
	var email = document.getElementById('email').value;
	var password = document.getElementById('password').value;
	var num = 0;

	createUserWithEmailAndPassword(auth, email, password)
  	.then((userCredential) => {
    // Signed in
    const user = userCredential.user;

	set(ref(database, 'users/'+user.uid),{
		username: username,
		email: email, 
		type: 0
	})
	alert('!Usuario creado con exito!');
    // ...
  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;

	
	alert(errorMessage);
    // ..
  });

});


//-------------------------Validar inicio de sesión------------
const user = auth.currentUser;
onAuthStateChanged(auth, (user)=> {

	if(user){
		uid = user.uid
		window.location.href = "index.html"

//-----------------------sí el usuario no esta registrado-------------
	} else {
		
	}
});

</script>

</html>